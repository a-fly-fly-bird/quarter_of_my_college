# 关键要点

# 步骤分析
1. 添加键盘事件监听
2. 对应点击事件处理程序
3. 为所有的 div.key 添加 transitionened 事件
4. 去除样式的事件处理程序

# 知识点

## JavaScript中的事件处理程序
### DOM1
在DOM1中，JavaScript 中指定事件处理程序的传统方式是把一个函数赋值给(DOM 元素的)一个事件处理程序属性。

### DOM2
DOM2 Events 为事件处理程序的赋值和移除定义了两个方法:addEventListener()和 remove- EventListener()。

使用 DOM2 方式的主要优势是可以为同一个事件添加多个事件处理程序。
### 事件委托-内存和性能
在 JavaScript 中，页面中事件处理程序的数量与页面整体性能直接相关。原因有很多。首先，每个函数都是对象，都占用内存空间，对象越多，性能越差。

“过多事件处理程序”的解决方案是使用事件委托。

## querySelector()
JavaScript 库中最流行的一种能力就是根据 CSS 选择符的模式匹配 DOM 元素。

通过浏览器原生支持这个 API，解析和遍历 DOM 树可以通过底层编译语言实现，性能也有了数量级的提升。(JavaScript性能有限)

## audio.play()
新创建的 HTMLAudioElement 对象，被设置为播放指定 url的音频文件。

调用该Element的paly()方法即可播放。

## setTimeout()的原理
JavaScript引擎是单线程，它会强制异步事件排队等待执行。

setTimeout()是异步执行的。每隔一段时间查询队列，所以可能由于线程被阻塞等原因导致不太准确。

## JavaScript中的异步，事件循环与消息队列

参考：https://zhuanlan.zhihu.com/p/139967525

JavaScript是一门单线程、异步、非阻塞、解析类型脚本语言。

其中，JavaScript 单线程指的是浏览器中负责解释和执行 JavaScript 代码的只有一个线程，即为JS引擎线程。

除此之外，浏览器还提供如下的进程：
* JS引擎线程
* 事件触发线程
* 定时触发器线程
* 异步http请求线程
* GUI渲染线程

当遇到计时器、DOM事件监听或者是网络请求的任务时，JS引擎会将它们直接交给 webapi，也就是浏览器提供的相应线程（如定时器线程为setTimeout计时、异步http请求线程处理网络请求）去处理，而JS引擎线程继续后面的其他任务，这样便实现了 异步非阻塞。

定时器触发线程也只是为 setTimeout(..., 1000) 定时而已，时间一到，还会把它对应的回调函数(callback)交给 任务队列 去维护，**JS引擎线程会在适当的时候去任务队列取出任务并执行**。

### 事件循环与消息队列
JS引擎线程什么时候去处理呢？消息队列又是什么？

JavaScript 通过 事件循环 event loop 的机制来解决这个问题。

其实 事件循环 机制和 任务队列 的维护是由事件触发线程控制的。

事件触发线程 同样是浏览器渲染引擎提供的，它会维护一个 任务队列。

JS引擎线程遇到异步（DOM事件监听、网络请求、setTimeout计时器等...），会交给相应的线程单独去维护异步任务，等待某个时机（计时器结束、网络请求成功、用户点击DOM），然后由 事件触发线程 将异步对应的 回调函数 加入到消息队列中，消息队列中的回调函数等待被执行。

同时，JS引擎线程会维护一个 执行栈，同步代码会依次加入执行栈然后执行，结束会退出执行栈。

如果执行栈里的任务执行完成，即执行栈为空的时候（即JS引擎线程空闲），事件触发线程才会从消息队列取出一个任务（即异步的回调函数）放入执行栈中执行。

一但"执行栈"中的所有同步任务执行完毕，系统就会读取"任务队列"，看看里面有哪些事件。那些对应的异步任务，于是结束等待状态，进入执行栈，开始执行。（**注意**，这里实际上是一个循环，也就是说去任务队列取一个执行完再去取下一个）。

## 异步和多线程的区别
继续上面的内容，我们可以弄清楚异步和多线程的关系。

可以看到，**JavaScript中的异步实际上就是通过多线程实现的**（开启一个额外的线程进行异步任务处理以不阻塞主线程的执行）。

多线程是指同时并发或并行执行多个指令（线程）。

在单核处理器上，多线程往往会给人程序是在并行执行的错觉。实际上，处理器是通过调度算法在多线程之间进行切换和调度。或者根据外部输入（中断）和线程的优先级的组合来进行线程的切换。

在多核处理器上，线程才是真正的并行运行。多个处理器同时执行多个线程，以达到更加高效的处理。

我的理解是异步的执行顺序是可以有预期的。